<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Project Management</title>
    <link rel="stylesheet" href="../css/summary.css">
    <link rel="icon" sizes="48x48" href="../img/logo.png">
    <link rel="apple-touch-icon" sizes="48x48" href="../img/logo.png">
    <script src="../lib/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="../script/header.js"></script>
</head>

<body>
    <!-- 헤더 영역 -->
    <header> </header>

    <div class="main">
        <div class="container">
            <div class="header">
                <div class="card" onclick="showContent('team')">
                    <h2>팀 프로젝트 현황</h2>
                </div>
                <div class="card" onclick="showContent('tasks')">
                    <h2>내 할일</h2>
                </div>
            </div>

            <div class="content" id="team">
                <div class="row">
                    <div class="left-column section-top-left">
                        <h3>팀원별 작업 현황 요약</h3>
                        <table id="team-tasks-table" class="team-tasks-table">
                            <thead>
                                <tr>
                                    <th class="status-th">팀원 이름</th>
                                    <th class="status-th status-완료">완료</th>
                                    <th class="status-th status-진행중">진행 중</th>
                                    <th class="status-th status-할일">할 일</th>
                                </tr>
                            </thead>
                            <tbody id="team-tasks-table-body" class="team-tasks-table-body"></tbody>
                            <tfoot id="team-tasks-table-footer" class="team-tasks-table-footer"></tfoot>
                        </table>
                    </div>

                    <div class="right-column section-top-right">
                        <h3>전체 프로젝트 진행률</h3>
                        <canvas id="projectProgressChart" width="400" height="400"></canvas>
                    </div>
                </div>

                <div class="row">
                    <div class="left-column section-bottom-left">
                        <h3>스프린트별 작업량</h3>
                        <label for="sprint-select"><strong>스프린트를 선택하세요:</strong></label>
                        <select id="sprint-select"></select>
                        <canvas id="sprintTasksChart" width="400" height="300"></canvas>
                    </div>

                    <div class="right-column section-bottom-right">
                        <h3>마감 임박 프로젝트</h3>
                        <ul id="urgent-tasks-list"></ul>
                    </div>
                </div>
            </div>




            <div class="content" id="tasks">
                <h3>작업 및 할 일</h3>
                <ul id="mytasks-list" class="mytasks-list">
                    <li>
                        <h4>Sprint 1</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>작업 이름</th>
                                    <th>상태</th>
                                    <th>우선순위</th>
                                    <th>마감일</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                            </tbody>
                        </table>
                    </li>
                    <li>
                        <h4>Sprint 1</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>작업 이름</th>
                                    <th>상태</th>
                                    <th>우선순위</th>
                                    <th>마감일</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                            </tbody>
                        </table>
                    </li>
                    <li>
                        <h4>Sprint 1</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>작업 이름</th>
                                    <th>상태</th>
                                    <th>우선순위</th>
                                    <th>마감일</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                            </tbody>
                        </table>
                    </li>
                    <li>
                        <h4>Sprint 1</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>작업 이름</th>
                                    <th>상태</th>
                                    <th>우선순위</th>
                                    <th>마감일</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                            </tbody>
                        </table>
                    </li>
                    <li>
                        <h4>Sprint 1</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>작업 이름</th>
                                    <th>상태</th>
                                    <th>우선순위</th>
                                    <th>마감일</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                            </tbody>
                        </table>
                    </li>
                    <li>
                        <h4>Sprint 1</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>작업 이름</th>
                                    <th>상태</th>
                                    <th>우선순위</th>
                                    <th>마감일</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                            </tbody>
                        </table>
                    </li>
                    <li>
                        <h4>Sprint 1</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>작업 이름</th>
                                    <th>상태</th>
                                    <th>우선순위</th>
                                    <th>마감일</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                            </tbody>
                        </table>
                    </li>
                    
                    <li>
                        <h4>Sprint 2</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>작업 이름</th>
                                    <th>상태</th>
                                    <th>우선순위</th>
                                    <th>마감일</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                                <tr>
                                    <td>UI 개선</td>
                                    <td>할 일</td>
                                    <td>높음</td>
                                    <td>2025년 01월 20일</td>
                                </tr>
                            </tbody>
                        </table>
                    </li>
                </ul>
            </div>




        </div>
    </div>



    <script>

        const projectId = sessionStorage.getItem("projectId");
        const userIdx = sessionStorage.getItem("userIdx"); // 로그인된 사용자 ID
        const userIdxh = localStorage.getItem("userIdx"); // 사용자 ID
        const projectIdh = localStorage.getItem("projectId"); // 프로젝트 ID
        const API_URL = "http://localhost:3000/api";
        //192.168.20.37


        function showContent(sectionId) {
            // 모든 콘텐츠 섹션 숨기기
            const contents = document.querySelectorAll('.content');
            contents.forEach((content) => {
                content.style.display = 'none'; // 인라인 스타일로 숨김 처리
            });

            // 클릭한 섹션만 표시
            const selectedContent = document.getElementById(sectionId);
            if (selectedContent) {
                selectedContent.style.display = 'block'; // 인라인 스타일로 표시
            } else {
                console.error(`섹션 ID를 찾을 수 없습니다: ${sectionId}`);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            showContent('team'); // 초기 상태: team 활성화
        });


        // ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
        // ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────




        $(document).ready(function () {





            /* 팀원별 작업 현황 요약 */

            // 팀원별 작업 현황 데이터를 가져오는 함수
            function fetchTeamTasks() {
                $.ajax({
                    url: `${API_URL}/summary/team/tasks`, // API URL
                    type: "GET",
                    data: { projectId: projectId }, // 쿼리 파라미터로 projectId 전달
                    success: function (data) {
                        renderTeamTasks(data); // 데이터를 렌더링 함수로 전달
                    },
                    error: function (xhr, status, error) {
                        console.error(error);
                        alert('팀원별 작업 데이터를 가져오는 중 오류가 발생했습니다.');
                    },
                });
            }

            // 팀원별 작업 현황 요약 렌더링
            function renderTeamTasks(tasks) {
                const tableBody = $("#team-tasks-table-body");
                const tableFooter = $("#team-tasks-table-footer"); // 테이블 푸터 영역
                tableBody.empty();
                tableFooter.empty();

                let totalCompleted = 0;
                let totalInProgress = 0;
                let totalToDo = 0;

                tasks.forEach((task, index) => {
                    // 본인 여부 확인
                    const isCurrentUser = Number(task.userIdx) === Number(userIdx);

                    // 작업 상태 합계 계산
                    totalCompleted += Number(task.completed);
                    totalInProgress += Number(task.inProgress);
                    totalToDo += Number(task.toDo);

                    // 테이블 행 생성
                    const tableRow = `
            <tr id="task-row-${index}" class="task-row ${isCurrentUser ? 'highlight-row' : ''}">
                <td id="member-name-${index}">${task.memberName}</td>
                <td id="completed-${index}">${task.completed}</td>
                <td id="in-progress-${index}">${task.inProgress}</td>
                <td id="to-do-${index}">${task.toDo}</td>
            </tr>
        `;
                    tableBody.append(tableRow);
                });

                // 총 작업량 표시
                const totalRow = `
        <tr class="total-row">
            <td><strong>총 작업량</strong></td>
            <td><strong>${totalCompleted}</strong></td>
            <td><strong>${totalInProgress}</strong></td>
            <td><strong>${totalToDo}</strong></td>
        </tr>
    `;
                tableFooter.append(totalRow);
            }


            // ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
            // ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────


            /* 전체 프로젝트 진행률 */

            // Chart.js 플러그인 등록
            Chart.register(ChartDataLabels);


            // 전체 프로젝트 진행률 데이터를 가져오는 함수
            async function fetchProjectProgress() {
                try {
                    const response = await fetch(`${API_URL}/summary/all/tasks?projectId=${projectId}`);
                    const data = await response.json();
                    renderProjectProgressChart(data); // 그래프에 데이터 전달
                } catch (error) {
                    console.error("Fetch error:", error);
                }
            }


            // Chart.js를 사용하여 원형 그래프 렌더링
            function renderProjectProgressChart(data) {

                const ctx = document.getElementById("projectProgressChart").getContext("2d");

                // 상태별 데이터
                const completed = parseInt(data.completed) || 0;
                const inProgress = parseInt(data.inProgress) || 0;
                const toDo = parseInt(data.toDo) || 0;
                const totalTasks = completed + inProgress + toDo;

                if (totalTasks === 0) {
                    console.error("작업 데이터가 없습니다.");
                    alert("작업 데이터가 없습니다.");
                    return;
                }

                // Chart.js 데이터
                const chartData = {
                    labels: ["완료", "진행 중", "할 일"],
                    datasets: [
                        {
                            data: [completed, inProgress, toDo],
                            backgroundColor: ["#28a745", "#ffc107", "#007bff"],
                            hoverBackgroundColor: ["#218838", "#e0a800", "#0056b3"],
                        },
                    ],
                };

                // Chart.js 옵션
                const options = {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const value = context.raw;
                                    const percentage = ((value / totalTasks) * 100).toFixed(2);
                                    return `${context.label}: ${value}개 (${percentage}%)`;
                                },
                            },
                        },
                        datalabels: {
                            color: "#fff", // 글자 색상
                            font: {
                                size: 14, // 글자 크기
                                weight: "bold", // 글자 굵기
                            },
                            formatter: function (value) {
                                return value; // 각 섹션의 값 표시
                            },
                        },
                    },
                };

                // 원형 그래프 생성
                new Chart(ctx, {
                    type: "pie",
                    data: chartData,
                    options: options,
                });
            }


            // ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
            // ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────



            /* 스프린트별 작업량 */

            // 그래프 인스턴스 저장 변수
            let sprintChart = null;

            // 프로젝트별 스프린트 목록 가져오기
            async function fetchProjectSprints(projectId) {
                try {
                    const response = await fetch(`${API_URL}/summary/projects/${projectId}/sprints`);
                    if (!response.ok) {
                        throw new Error(`Failed to fetch project sprints. Status: ${response.status}`);
                    }

                    const sprints = await response.json();

                    const sprintSelect = document.getElementById("sprint-select");
                    sprintSelect.innerHTML = ""; // 기존 옵션 초기화

                    // 스프린트 옵션 추가
                    sprints.forEach((sprint) => {
                        const option = document.createElement("option");
                        option.value = sprint.sprintId;
                        option.textContent = sprint.sprintName;
                        sprintSelect.appendChild(option);
                    });

                    // 첫 번째 스프린트 데이터로 초기화
                    if (sprints.length > 0) {
                        fetchSprintTasks(sprints[0].sprintId);
                    } else {
                        alert("해당 프로젝트에는 스프린트가 없습니다.");
                    }
                } catch (error) {
                    console.error("Fetch error:", error);
                    alert("스프린트 목록을 가져오는 중 오류가 발생했습니다.");
                }
            }


            // 특정 스프린트의 작업량 데이터를 가져오는 함수
            async function fetchSprintTasks(sprintId) {
                try {
                    const response = await fetch(`${API_URL}/summary/sprints/${sprintId}/team/tasks`);
                    if (!response.ok) {
                        throw new Error(`Failed to fetch sprint tasks. Status: ${response.status}`);
                    }

                    const data = await response.json();

                    renderSprintTasksChart(data);
                } catch (error) {
                    console.error("Fetch error:", error);
                    alert("스프린트 작업 데이터를 가져오는 중 오류가 발생했습니다.");
                }
            }


            // 스프린트 작업량 데이터를 막대그래프로 렌더링하는 함수
            function renderSprintTasksChart(data) {
                const ctx = document.getElementById("sprintTasksChart").getContext("2d");

                // 기존 그래프 제거
                if (sprintChart) {
                    sprintChart.destroy();
                }

                // 데이터 처리
                const labels = data.map((task) => task.memberName); // 팀원 이름
                const taskCounts = data.map((task) => task.taskCount); // 작업량
                const maxValue = Math.max(...taskCounts); // 작업량 중 최대값 계산
                const yMax = maxValue < 5 ? 5 : Math.ceil(maxValue / 5) * 5; // 최대값이 5 미만일 경우 최소 5로 설정, 5의 배수로 맞춤

                // 고정된 색상 배열 (팀원별 고유 색상)
                const fixedColors = [
                    "#FF5733", // 빨강
                    "#33FF57", // 초록
                    "#3357FF", // 파랑
                    "#FF33A1", // 분홍
                    "#FFC300", // 노랑
                    "#33FFF5", // 민트
                    "#A833FF", // 보라
                ];

                // 팀원별 색상 할당
                const backgroundColors = labels.map((_, index) => fixedColors[index % fixedColors.length]);
                const hoverColors = backgroundColors.map((color) => `${color}CC`); // 약간 투명도를 추가하여 어둡게 표현 (CSS rgba 방식)

                // Chart.js 데이터
                const chartData = {
                    labels: labels,
                    datasets: [
                        {
                            label: "작업량",
                            data: taskCounts,
                            backgroundColor: backgroundColors, // 팀원별 고유 색상 적용
                            hoverBackgroundColor: hoverColors, // 호버 시 약간 어두운 색상
                            barThickness: 20, // 막대 두께 설정
                        },
                    ],
                };

                // Chart.js 옵션
                const options = {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            min: 0, // Y축 최솟값 설정
                            max: yMax, // 동적으로 최대값 설정
                            ticks: {
                                stepSize: 5, // 눈금 간격
                            },
                            title: {
                                display: true,
                                text: "작업량 (개)",
                            },
                        },
                        x: {
                            title: {
                                display: true,
                                text: "팀원",
                            },
                        },
                    },
                };

                // 새로운 그래프 생성
                sprintChart = new Chart(ctx, {
                    type: "bar",
                    data: chartData,
                    options: options,
                });
            }


            // 드롭다운 변경 이벤트 핸들러
            document.getElementById("sprint-select").addEventListener("change", (event) => {
                const selectedSprintId = event.target.value;
                fetchSprintTasks(selectedSprintId); // 선택된 스프린트 데이터 가져오기
            });


            // ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
            // ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────





            /* 마감 임박 프로젝트 */

            // 마감 기한이 하루 남은 작업 가져오기
            async function fetchUrgentTasks() {
                try {
                    const response = await fetch(`${API_URL}/summary/tasks/urgent`);
                    if (!response.ok) throw new Error(`Failed to fetch urgent tasks. Status: ${response.status}`);

                    const tasks = await response.json();
                    console.log("마감 임박 작업 데이터:", tasks); // 응답 데이터 확인
                    renderUrgentTasks(tasks);
                } catch (error) {
                    console.error("Error fetching urgent tasks:", error);
                    alert("마감 기한이 하루 남은 작업 데이터를 가져오는 중 오류가 발생했습니다.");
                }
            }


            // 리스트 형식
            // 작업 데이터를 리스트에 렌더링 
            function renderUrgentTasks(tasks) {
                const taskList = document.getElementById("urgent-tasks-list");
                if (!taskList) {
                    console.error("urgent-tasks-list 요소를 찾을 수 없습니다.");
                    return;
                }

                taskList.innerHTML = ""; // 기존 내용 초기화

                if (tasks.length === 0) {
                    taskList.innerHTML = "<li>마감 기한이 하루 남은 작업이 없습니다.</li>";
                    return;
                }

                tasks.forEach((task) => {
                    // 날짜 변환 (ISO 형식 -> "YYYY년 MM월 DD일")
                    const dueDate = new Date(task.dueDate);
                    const formattedDate = `${dueDate.getFullYear()}년 ${String(dueDate.getMonth() + 1).padStart(2, "0")}월 ${String(dueDate.getDate()).padStart(2, "0")}일`;

                    const listItem = document.createElement("li");
                    listItem.className = "urgent-task-item";

                    listItem.innerHTML = `
                        <strong>${task.taskName}</strong>
                        : <em>마감일: ${formattedDate}</em>
                         <span>우선순위: ${task.priority}</span>
                         <span>담당자: ${task.assignedTo || "미정"}</span>
                    `;
                    taskList.appendChild(listItem);
                });
            }


            // 카드 형식
            // 작업 데이터를 카드에 렌더링 
            /*function renderUrgentTasks(tasks) {

                const container = document.getElementById("urgent-tasks-container");
                if (!container) {
                    console.error("urgent-tasks-container 요소를 찾을 수 없습니다.");
                    return;
                }
            
                container.innerHTML = ""; // 기존 내용 초기화
            
                if (tasks.length === 0) {
                    container.innerHTML = "<p>마감 기한이 하루 남은 작업이 없습니다.</p>";
                    return;
                }
            
                tasks.forEach((task) => {
                    // 날짜 변환 (ISO 형식 -> "YYYY년 MM월 DD일")
                    const dueDate = new Date(task.dueDate);
                    const formattedDate = `${dueDate.getFullYear()}년 ${String(dueDate.getMonth() + 1).padStart(2, "0")}월 ${String(dueDate.getDate()).padStart(2, "0")}일`;
            
                    // 카드 생성
                    const card = document.createElement("div");
                    card.className = "task-card";
            
                    card.innerHTML = `
                        <h4>${task.taskName}</h4>
                        <p><strong>마감일:</strong> ${formattedDate}</p>
                        <p><strong>우선순위:</strong> ${task.priority}</p>
                        <p><strong>담당자:</strong> ${task.assignedTo || "미정"}</p>
                    `;
            
                    container.appendChild(card);
                });
            
                // 스크롤 자동 활성화 확인
                container.scrollTop = 0; // 처음 카드로 스크롤 위치 초기화
            }*/

            // ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
            // ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

            // 페이지 로드 시 데이터 가져오기
            fetchTeamTasks();
            fetchProjectProgress();
            fetchProjectSprints(projectId);
            fetchUrgentTasks();



        });






        function renderTasksBySprint(tasks) {
            const tasksList = document.getElementById("tasks-list");
            tasksList.innerHTML = "";
        
            const groupedTasks = tasks.reduce((group, task) => {
                group[task.sprintName] = group[task.sprintName] || [];
                group[task.sprintName].push(task);
                return group;
            }, {});
        
            for (const [sprintName, sprintTasks] of Object.entries(groupedTasks)) {
                const listItem = document.createElement("li");
        
                listItem.innerHTML = `
                    <h4>${sprintName}</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>작업 이름</th>
                                <th>상태</th>
                                <th>우선순위</th>
                                <th>마감일</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sprintTasks
                                .map(
                                    (task) => `
                                    <tr>
                                        <td>${task.taskName}</td>
                                        <td>${task.taskStatus}</td>
                                        <td>${task.priority}</td>
                                        <td>${task.dueDate}</td>
                                    </tr>
                                `
                                )
                                .join("")}
                        </tbody>
                    </table>
                `;
        
                tasksList.appendChild(listItem);
            }
        }
    </script>


</body>

</html>