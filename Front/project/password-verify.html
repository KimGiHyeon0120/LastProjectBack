<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" sizes="48x48" href="../img/logo.png">
    <link rel="apple-touch-icon" sizes="48x48" href="../img/logo.png">
    <script src="../lib/jquery-3.7.1.min.js"></script>
    <script src="../script/header.js"></script>
    <script src="../script/profile_main.js"></script>
    <link rel="stylesheet" href="../css/password-verify.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <title>비밀번호 확인</title>
</head>
<body>
    <div class="password-verify-container">
        <h1>비밀번호 확인</h1>
        <p>프로필을 수정하려면 비밀번호를 입력하세요.</p>

        <form id="password-verify-form">
            <div class="password-form-inner">
                <input type="password" id="password-input" placeholder="비밀번호를 입력하세요" required />
                <div class="form-actions">
                    <button type="submit">확인</button>
                    <button type="button" onclick="goBack()">취소</button>
                </div>
            </div>
            
        </form>

        <p id="error-message" class="error hidden">비밀번호가 일치하지 않습니다.</p>
    </div>

    <script>
        // 서버에 비밀번호 확인 요청
        document.getElementById('password-verify-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const password = document.getElementById('password-input').value;

            try {
                const response = await fetch('/api/user/verify-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password }),
                });

                if (response.ok) {
                    // 비밀번호 일치 -> 프로필 수정 페이지로 이동
                    window.location.href = 'profile-edit.html';
                } else {
                    // 비밀번호 불일치 -> 오류 메시지 표시
                    document.getElementById('error-message').classList.remove('hidden');
                }
            } catch (error) {
                console.error('서버 오류:', error);
                alert('비밀번호 확인 중 오류가 발생했습니다.');
            }
        });

        // 이전 화면으로 돌아가기
        function goBack() {
            window.history.back();
        }
    </script>
</body>
</html>
